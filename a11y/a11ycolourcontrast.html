<!DOCTYPE html>
<html lang="en">
<head>
  <!-- 		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> -->
  <meta charset="utf-8"/>
  <meta name="author" content="CorporateTool.Net"/>
  <meta name="Keywords" content="accessibility color contrast html aria WCAG"/>
  <meta name="Description" content="A test web page for color contrast accessibility testing"/>
  <meta name="robots" content="all"/>
  <meta name="docref" content="a11y contrast color test - a11ycolorcontrast.html"/>
  <title aria-label="Accessibility Colour Contrast Test Page - CorporateTool dot Net">Accessibility Colour Contrast Test Page -
    CorporateTool.Net</title>
  <link type="image/vnd.microsoft.icon" rel="shortcut icon" href="/resources/images/favicon.ico"/>
  <link type="image/vnd.microsoft.icon" rel="icon" href="/resources/images/favicon.ico"/>
  <script>

    let bgColor = '';
    let fgColor = '';
    let fgOpacity = 1;
    let fontColor = '';
    let fontOpacity = 1;

    function updateColors() {

      colorInputs.forEach(function(colorInput) {
        console.log(colorInput);
        switch (colorInput.id) {
          case 'backgroundColor':
            console.log('backgroundColor', colorInput.value, backgroundColorDisplay);
            // if (colorInput.value) {
            backgroundColorDisplay.style.backgroundColor = colorInput.value;
            bgColor = colorInput.value;
            // }
            break;
          case 'foregroundColor':
            console.log('foregroundColor', colorInput.value);
            foregroundColorDisplay.style.backgroundColor = colorInput.value;
            fgColor = colorInput.value;
            break;
          case 'foregroundOpacity':
            console.log('foregroundOpacity', colorInput.value);
            foregroundColorDisplay.style.opacity = colorInput.value;
            fgOpacity = colorInput.value;
            break;
          case 'fontColor':
            console.log('fontColor', colorInput.value);
            fontTextDisplay.style.color = colorInput.value;
            fontColorDisplay.style.backgroundColor = colorInput.value;
            fontColor = colorInput.value;
            break;
          case 'fontOpacity':
            console.log('fontOpacity', colorInput.value);
            fontTextDisplay.style.opacity = colorInput.value;
            fontColorDisplay.style.opacity = colorInput.value;
            fontOpacity = colorInput.value;
            break;
          default:
            console.log(`error in switch.`);
        }
      });

      let foregroundStyles = window.getComputedStyle(foregroundColorDisplay);
      console.log('foregroundStyles computed color is ', foregroundStyles.getPropertyValue('color'));
      console.log('foregroundStyles computed background color is', foregroundStyles.getPropertyValue('background-color'));
      let fontTextStyles = window.getComputedStyle(fontTextDisplay);
      console.log('Font Text computed color is ', foregroundStyles.getPropertyValue('color'));
      // console.log('computed line-height is', foregroundStyles.getPropertyValue('line-height'));
      let fontColorStyles = window.getComputedStyle(fontColorDisplay);
      console.log('computed background color is ', fontColorStyles.getPropertyValue('background-color'));
      // console.log('computed line-height is', foregroundStyles.getPropertyValue('line-height'));


      let fgComputed = calculateColor(bgColor, fgColor, fgOpacity || 1).toUpperCase();
      console.log('fgOpacity', fgOpacity);

      let fontComputed = fontColor;

      let haveFgOpacity = (fgOpacity !== '' && fgOpacity < 1);
      let haveFontOpacity = (fontOpacity !== '' && fontOpacity < 1);

      let calcBg = bgColor;
      let calcFg = fontColor;
      let calcOp = fgOpacity;

      if (haveFgOpacity && haveFontOpacity) {
        calcFg = calculateColor(fgColor, fontColor, fontOpacity);
        console.log('We have both:', calcFg);
        fontComputed = '#' + calculateColor(calcBg, calcFg, calcOp).toUpperCase();
      } else if (haveFontOpacity) {
        console.log('bg, f, fontOpacity:', calculateColor(fgComputed, fontColor, fontOpacity));
        calcBg = fgComputed;
        calcOp = fontOpacity;
        fontComputed = '#' + calculateColor(calcBg, calcFg, calcOp).toUpperCase();
      } else if (haveFgOpacity) {
        fontComputed = '#' + calculateColor(calcBg, calcFg, calcOp).toUpperCase();
      }
      //         fontComputed = '#' + calculateColor(calcBg, calcFg, calcOp).toUpperCase();

      /*
      Background Color	#FFFFFF	N/A	N/A
      Foreground Color	#000000	0.4	#999999
      Font Color	#AAAAAA		#DDDDDD
      background 000 color #AAAAAA opacity 0.7 computed color 777777
      #000000	0.4	#999999 | #AAAAAA 0.7 #C9C9C9

       */

      console.log('fgOpacity', fgOpacity);

      backgroundColorEntered.innerText = bgColor.toUpperCase();
      foregroundColorEntered.innerText = fgColor.toUpperCase();
      foregroundColorEnteredSwatch.style.backgroundColor = fgColor;
      foregroundColorOpacity.innerText = fgOpacity;
      foregroundColorComputed.innerText = '#' + fgComputed.toUpperCase();
      foregroundColorComputedSwatch.style.backgroundColor = '#' + fgComputed;

      fontColorEntered.innerText = fontColor.toUpperCase();
      fontColorEnteredSwatch.style.backgroundColor = fontColor;
      fontColorOpacity.innerText = fontOpacity;
      fontColorComputed.innerText = fontComputed;
      fontColorComputedSwatch.style.backgroundColor = fontComputed;
      // backgroundColorComputed  fontTextComputed

      // https://webaim.org/resources/contrastchecker/?fcolor=999999&bcolor=FFFFFF&api

    }

    function returnHex(intValue) {
      return intValue > 0 ? intValue.toString(16) : '00';
    }

    function calculateColor(backgroundHex, colorHex, opacity = 1) {
      console.log(backgroundHex, colorHex, opacity);
      const bg = parseColor(backgroundHex);
      const color = parseColor(colorHex);
      const resultColor = getColor(bg, color, opacity);



      console.log(returnHex(resultColor.r));

      const computedColor = returnHex(resultColor.r)
              + returnHex(resultColor.g)
              + returnHex(resultColor.b);
      console.log('background', backgroundHex, 'color', colorHex, 'opacity', opacity, 'computed color', computedColor, 'resultColor', resultColor);
      return computedColor;
    }

    // function calculate() {
    //   const bg = parseColor(background.value);
    //   const color = parseColor(document.getElementById('color').value);
    //   const resultColor = getColor(bg, color, opacity.value);
    //
    //   return resultColor.r.toString(16)
    //           + resultColor.g.toString(16)
    //           + resultColor.b.toString(16);
    // }

    function parseColor(clr) {
      if (!clr) throw new Error('Color must not be empty!')
      if (clr[0]=='#') clr = clr.slice(1);
      if (clr.length != 3 && clr.length != 6) throw new Error('Incorrect color value!');
      return clr.length == 3
              ? {
                r: parseInt(clr[0]+clr[0], 16),
                g: parseInt(clr[1]+clr[1], 16),
                b: parseInt(clr[2]+clr[2], 16)
              }
              : {
                r: parseInt(clr.slice(0,2), 16),
                g: parseInt(clr.slice(2,4), 16),
                b: parseInt(clr.slice(4,6), 16)
              };
    }

    function getColor(bg, clr, op) {
      // check if <== 1
      console.log('op', op);
      console.log('op * 100', op * 100);
      op = op * 100;
      return {
        r: getClr(bg.r, clr.r, op),
        g: getClr(bg.g, clr.g, op),
        b: getClr(bg.b, clr.b, op)
      }
    }

    function getClr(bg, clr, op) {
      op = op / 100;
      return Math.round(bg + op * (clr - bg));
    }

    function handleChange(e) {
      console.log(e.currentTarget.value, e);
      // log.textContent = `The field's value is
      //   ${e.target.value.length} character(s) long.`;
      updateColors();
    }

    /*
<style>
  h3::after {
    content: ' rocks!';
  }
</style>

<h3>Generated content</h3>

<script4>
  var h3 = document.querySelector('h3');
  var result = getComputedStyle(h3, ':after').content;

  console.log('the generated content is: ', result); // returns ' rocks!'
</script4>
 */



  </script>
  <style>
  /*
    In most browsers, the placeholder text is grey. To change this, style the placeholder with the non-standard ::placeholder selector. Note that Firefox adds a lower opacity to the placeholder, so we use opacity: 1 to fix this.
    Example */
    .styled-placeholder::placeholder { /* Chrome, Firefox, Modern Edge, Safari 10.1+ */
      color: red;
      opacity: 1; /* Firefox */
    }


    .results-wrapper {
      display: flex;
      align-items: flex-start;
    }
    .results-table tr {
    }

    .results-table th, .results-table td  {
      padding: 5px;
      /*vertical-align: top;*/
    }

  .results-table th[scope="row"] {
    text-align: right;
  }

    .layerinfo {
      background-color: #FFFFFF;
      color: #000000;
      opacity: 1;
    }

    .colorcontrast {

    }

    .colorentry {
      display: inline-block;
    }

    .backgroundcolor {
      width: 300px;
      height: 200px;
      border: 1px solid #000000;
      margin: 25px 5px 5px 5px;
      padding: 5px;
    }

    .colorswatch {
      width: 15px;
      height: 15px;
      display: inline-block;
    }

    .foregroundcolor {
      width: 250px;
      height: 150px;
      border: 1px solid #FF0000;
      margin: 5px;
      padding: 5px;
      color: #FF0000;
    }

    .fontcolor {
      width: 190px;
      height: 40px;
      margin: 5px;
      padding: 5px;
      border: 1px solid #FFFF00;
    }

  </style>
</head>
<body>
<div id="container">
  <div id="chewycenter">
    <h1>CT.Net Accessibility Colour Contrast Test Page</h1>
    <a href="a11yindex.html" id="topAnchor">Back to A11y Index</a>
    <form id="colorContrast" class="colorcontrast">
      <div class="colorentry">
        <label for="backgroundColor">Background Color:<br> HEX: #FFFFFF</label><br>
        <input type="text" id="backgroundColor" name="backgroundColor" value="#FFFFFF">
      </div>
      <div class="colorentry">
        <label for="foregroundColor">Foreground Color:<br> HEX: #000000</label><br>
        <input type="text" id="foregroundColor" name="foregroundColor" value="#000000">
      </div>
      <div class="colorentry">
        <label for="foregroundOpacity">Foreground Opacity:<br> Decimal: 0.7</label><br>
        <input type="text" id="foregroundOpacity" name="foregroundOpacity" value="0.4">
      </div>
      <div class="colorentry">
        <label for="fontColor">Font Color:<br> HEX: #AAAAAA</label><br>
        <input type="text" id="fontColor" name="fontColor" value="#AAAAAA">
      </div>
      <div class="colorentry">
        <label for="fontOpacity">Font Opacity:<br> Decimal: 0.7</label><br>
        <input type="text" id="fontOpacity" name="fontOpacity">
      </div><br>
      <input type="reset">

      <!--
      <div class="layerinfo">Background Color <span id="backgroundColorEntered2"></span></div>
      <div class="layerinfo">
        Foreground Color - Entered: <span id="foregroundColorEntered2"></span>
        - Opacity: <span id="foregroundColorOpacity2"></span>
        | Computed: <span id="foregroundColorComputed2"></span>
      </div>
      <div class="layerinfo">Font Color:
        Foreground Color - Entered: <span id="fontColorEntered2"></span>
        - Opacity: <span id="fontColorOpacity2"></span>
        | Computed: <span id="fontColorComputed2"></span>
      </div> -->

      <div class="results-wrapper">
        <table class="results-table">
          <caption>Color Initial and Computed Values</caption>
          <tbody>
          <tr>
            <th scope="col">Layer</th>
            <th scope="col">Entered<br>Color</th>
            <th scope="col">Entered<br>Opacity</th>
            <th scope="col">Computed<br>Color</th>
          </tr>
          <tr>
            <th scope="row">Background Color</th>
            <td><code id="backgroundColorEntered"></code></td>
            <td><code>N/A</code></td>
            <td><code>N/A</code></td>
          </tr>
          <tr>
            <th scope="row">Foreground Color</th>
            <td><code id="foregroundColorEntered"></code> <div id="foregroundColorEnteredSwatch" class="colorswatch"></div></td>
            <td><code id="foregroundColorOpacity"></code></td>
            <td><code id="foregroundColorComputed"></code> <div id="foregroundColorComputedSwatch" class="colorswatch"></div></td>
          </tr>
          <tr>
            <th scope="row">Font Color</th>
            <td><code id="fontColorEntered"></code> <div id="fontColorEnteredSwatch" class="colorswatch"></div></td>
            <td><code id="fontColorOpacity"></code></td>
            <td><code id="fontColorComputed"></code> <div id="fontColorComputedSwatch" class="colorswatch"></div></td>
          </tr>
          </tbody>
        </table>
        <div id="backgroundColorDisplay" class="backgroundcolor">Background
          <div id="foregroundColorDisplay" class="foregroundcolor">Foreground
            <div id="fontTextDisplay" class="fontcolor">This is the font text</div>
            <div id="fontColorDisplay" class="fontcolor">This is the text color</div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
</body>
<script>
  const colorContrast = document.getElementById('colorContrast');
  const colorInputs = colorContrast.querySelectorAll('input[type="text"]');

  const backgroundColorEntered = document.getElementById('backgroundColorEntered');
  const foregroundColorEntered = document.getElementById('foregroundColorEntered');
  const foregroundColorEnteredSwatch = document.getElementById('foregroundColorEnteredSwatch');
  const foregroundColorOpacity = document.getElementById('foregroundColorOpacity');
  const foregroundColorComputed = document.getElementById('foregroundColorComputed');
  const foregroundColorComputedSwatch = document.getElementById('foregroundColorComputedSwatch');
  const fontColorEntered = document.getElementById('fontColorEntered');
  const fontColorEnteredSwatch = document.getElementById('fontColorEnteredSwatch');
  const fontColorOpacity = document.getElementById('fontColorOpacity');
  const fontColorComputed = document.getElementById('fontColorComputed');
  const fontColorComputedSwatch = document.getElementById('fontColorComputedSwatch');

  const backgroundColorDisplay = document.getElementById('backgroundColorDisplay');
  const foregroundColorDisplay = document.getElementById('foregroundColorDisplay');
  const fontTextDisplay = document.getElementById('fontTextDisplay');
  const fontColorDisplay = document.getElementById('fontColorDisplay');


  console.log(colorContrast);
  console.log(colorInputs);

  colorInputs.forEach(function(colorInput) {
    console.log(colorInput);
    colorInput.onchange = handleChange;
  });

  updateColors();
</script>
<!--
<style>

   .mybackground {
      /*background-color: #000000;*/
      background-color: #FFFFFF;
    }

    .mycolor {
      width: 200px;
      height: 100px;
      /*background-color: #FFFFFF;*/
      background-color: #000000;
      border: 2px;
    }
    .myopacity {
      width: 150px;
      height: 50px;
      /*opacity: 0.3;*/
      /*opacity: 0.7; */
      opacity: 0.4;
      color: #9e9e9e;

    }

    .myhooverbackground {
      width: 150px;
      height: 50px;
      background-color: #757575;
    }

</style>>

<div class="mybackground">Background
      <div class="mycolor">Color</div>
      <div class="mycolor myopacity">Opacity</div>
      <div class="myhooverbackground">Hover Background</div>
    </div>-->
</html>
